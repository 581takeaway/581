import React, { useState } from 'react';
import { 
  Home,
  Store,
  FileText, 
  BarChart2, 
  Users, 
  FileBarChart, 
  Megaphone, 
  Ticket, 
  Target, 
  BookOpen, 
  CreditCard, 
  Settings, 
  ChevronRight, 
  ChevronDown,
  ChevronUp,
  Clock, 
  CheckCircle2, 
  XCircle, 
  TrendingUp, 
  DollarSign,
  Star,
  AlertTriangle,
  QrCode,
  ToggleRight,
  ToggleLeft,
  Phone,
  Landmark, 
  Receipt,
  Search, 
  Plus,
  Lock,
  Calendar,
  MoreHorizontal,
  Filter,
  AlertCircle,
  TrendingDown, 
  Eye, 
  MousePointer2,
  ThumbsUp, 
  ThumbsDown, 
  Camera, 
  Zap,
  ShoppingBag,
  Menu, 
  X,
  PieChart,
  MessageSquare,
  FilePlus, 
  MonitorPlay,
  Tag,
  Utensils, 
  ShoppingCart, 
  Gift, 
  Percent, 
  Timer,
  Info,
  Image as ImageIcon,
  Edit2,
  Download, 
  Wallet,
  Smile,
  Check,
  FileCheck, 
  Upload,    
  CalendarDays,
  UserPlus,
  ArrowRight
} from 'lucide-react';

// --- Types ---
type CategoryId = 
  | 'home' 
  | 'stores' 
  | 'orders' 
  | 'performance' 
  | 'customers' 
  | 'reports' 
  | 'ads' 
  | 'offers' 
  | 'marketing' 
  | 'menu' 
  | 'payments' 
  | 'users' 
  | 'settings';

interface Feature {
  id: string;
  title: string;
  description: string;
  icon: React.ReactNode;
  usage: string;
  tips?: string;
  mockUI: React.ReactNode;
}

interface SubLabel {
  label: string;
  featureId: string;
}

interface Category {
  id: CategoryId;
  label: string;
  icon: React.ReactNode;
  subLabels?: SubLabel[];
  features: Feature[];
}

// --- Mock UI Components (Strict Uber Eats Theme) ---

// 1. 首頁 (Home)
const MockHomeDashboard = () => (
  <div className="bg-[#F6F6F6] min-h-full p-6 font-sans text-black">
    <div className="max-w-7xl mx-auto space-y-6">
      {/* Alert */}
      <div className="bg-[#FFF5F5] border-l-4 border-[#E11900] p-4 flex justify-between items-center rounded-r-md shadow-sm">
        <div className="flex items-center gap-3">
          <AlertCircle className="text-[#E11900]" size={24} />
          <div>
            <h3 className="font-bold text-[#E11900] text-base">商店無法接單</h3>
            <p className="text-[#E11900] text-sm">檢查您的營業時間設定。</p>
          </div>
        </div>
        <button className="bg-white border border-[#E2E2E2] text-[#E11900] text-sm font-bold px-4 py-2 rounded-full hover:bg-[#FFF0F0] transition-colors">
          查看詳情
        </button>
      </div>

      {/* Task Cards */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <div className="bg-white p-6 rounded-xl border border-[#E2E2E2] shadow-sm hover:shadow-md transition-all cursor-pointer h-36 flex flex-col justify-between group">
          <div className="flex justify-between items-start">
            <div className="bg-[#E8F8F0] p-2 rounded-full text-[#06C167] group-hover:scale-105 transition-transform"><Clock size={24}/></div>
            <ChevronRight size={20} className="text-[#AFAFAF] group-hover:text-black transition-colors"/>
          </div>
          <div>
            <div className="font-bold text-lg text-black">設定營業時間</div>
            <div className="text-sm text-[#545454] mt-1">確保顧客知道何時可點餐</div>
          </div>
        </div>
        <div className="bg-white p-6 rounded-xl border border-[#E2E2E2] shadow-sm hover:shadow-md transition-all cursor-pointer h-36 flex flex-col justify-between group">
          <div className="flex justify-between items-start">
            <div className="bg-[#EBF5FF] p-2 rounded-full text-[#276EF1] group-hover:scale-105 transition-transform"><FileText size={24}/></div>
            <ChevronRight size={20} className="text-[#AFAFAF] group-hover:text-black transition-colors"/>
          </div>
          <div>
            <div className="font-bold text-lg text-black">完成菜單設定</div>
            <div className="text-sm text-[#545454] mt-1">新增更多餐點照片</div>
          </div>
        </div>
      </div>

      {/* Stats Header */}
      <div className="flex justify-between items-end pt-2">
        <div>
          <div className="text-sm text-[#545454] font-bold mb-1">9月12日</div>
          <h2 className="text-3xl font-bold text-black">今天業績</h2>
        </div>
        <button className="bg-white border border-[#E2E2E2] px-4 py-2 rounded-full text-sm font-bold shadow-sm flex items-center gap-2 hover:bg-[#FAFAFA] transition-colors text-black">
          所有商店 (1) <ChevronDown size={16}/>
        </button>
      </div>

      {/* Stats Board */}
      <div className="bg-white rounded-xl shadow-sm border border-[#E2E2E2] p-6">
        <div className="grid grid-cols-3 gap-6 divide-x divide-[#E2E2E2]">
          <div className="px-4">
            <div className="text-sm text-[#545454] mb-2 font-medium">銷售額</div>
            <div className="text-4xl font-bold text-black tracking-tight">$10,653</div>
            <div className="text-xs text-[#AFAFAF] mt-2 font-medium">總銷售金額</div>
          </div>
          <div className="px-4">
            <div className="text-sm text-[#545454] mb-2 font-medium">訂單</div>
            <div className="text-4xl font-bold text-black tracking-tight">79</div>
            <div className="text-xs text-[#AFAFAF] mt-2 font-medium">完成訂單數</div>
          </div>
          <div className="px-4">
            <div className="text-sm text-[#545454] mb-2 font-medium">平均訂單金額</div>
            <div className="text-4xl font-bold text-black tracking-tight">$358</div>
            <div className="text-xs text-[#AFAFAF] mt-2 font-medium">每單平均</div>
          </div>
        </div>
      </div>
    </div>
  </div>
);

// 2. 餐廳門市 (Stores)
const MockStoresPage = () => (
  <div className="bg-[#F6F6F6] min-h-full p-6 font-sans text-black">
    <div className="max-w-7xl mx-auto space-y-6">
      <div className="flex justify-between items-center">
         <h2 className="text-3xl font-bold text-black">餐廳</h2>
         <div className="flex gap-3">
           <button className="bg-white border border-[#E2E2E2] px-4 py-2 rounded-full text-sm font-bold shadow-sm hover:bg-[#FAFAFA] transition-colors text-black">篩選</button>
           <button className="bg-white border border-[#E2E2E2] px-4 py-2 rounded-full text-sm font-bold shadow-sm hover:bg-[#FAFAFA] transition-colors text-black">排序依據</button>
         </div>
      </div>

      <div>
        <h3 className="text-lg font-bold text-black mb-4">離線商店</h3>
        <div className="space-y-4">
          <div className="bg-white p-6 rounded-xl border border-[#E2E2E2] shadow-sm flex flex-col gap-4">
             <div className="flex justify-between items-start">
               <div>
                 <h4 className="font-bold text-xl text-black">美味餐廳 - 台北松山店</h4>
                 <p className="text-sm text-[#545454] mt-1">台北市松山區民生東路...</p>
               </div>
               <div className="flex items-center gap-2">
                 <span className="text-sm font-bold bg-[#EEEEEE] px-2 py-1 rounded flex items-center gap-1 text-black">4.5 <Star size={12} fill="black"/></span>
                 <MoreHorizontal size={20} className="text-[#545454] cursor-pointer"/>
               </div>
             </div>
             <div className="flex items-center gap-2 bg-[#FFF5F5] p-2 rounded w-fit">
               <div className="w-2 h-2 bg-[#E11900] rounded-full"></div>
               <span className="text-sm font-bold text-[#E11900]">已離線超過 24 小時</span>
             </div>
             <div className="grid grid-cols-3 gap-4 text-sm border-t border-[#E2E2E2] pt-4">
               <div><div className="text-[#545454] mb-1 font-medium">銷售額</div><div className="font-bold text-lg">$0</div></div>
               <div><div className="text-[#545454] mb-1 font-medium">訂單數</div><div className="font-bold text-lg">0</div></div>
               <div><div className="text-[#545454] mb-1 font-medium">失去的銷售額</div><div className="font-bold text-lg text-[#E11900]">$0</div></div>
             </div>
          </div>
        </div>
      </div>

      <div>
        <div className="flex justify-between items-center mb-4">
          <h3 className="text-lg font-bold text-black">營業中商店</h3>
          <button className="text-sm text-[#06C167] font-bold hover:underline">查看今日訂單</button>
        </div>
        <div className="space-y-4">
          <div className="bg-white p-6 rounded-xl border border-[#E2E2E2] shadow-sm flex flex-col gap-4 border-l-4 border-l-[#06C167]">
             <div className="flex justify-between items-start">
               <div>
                 <h4 className="font-bold text-xl text-black">美味餐廳 - 旗艦店</h4>
                 <p className="text-sm text-[#545454] mt-1">台北市大安區忠孝東路...</p>
               </div>
               <div className="w-3 h-3 rounded-full bg-[#06C167] shadow-[0_0_0_4px_rgba(6,193,103,0.2)]"></div>
             </div>
             <div className="flex items-center gap-2 text-[#06C167]">
               <Clock size={16}/>
               <span className="text-sm font-bold">開放至 上午 11:00</span>
             </div>
             <div className="grid grid-cols-2 gap-4 text-sm border-t border-[#E2E2E2] pt-4">
               <div><div className="text-[#545454] mb-1 font-medium">銷售額</div><div className="font-bold text-lg text-[#06C167]">$12,450</div></div>
               <div><div className="text-[#545454] mb-1 font-medium">訂單數</div><div className="font-bold text-lg">38</div></div>
             </div>
          </div>
        </div>
      </div>
    </div>
  </div>
);

// 3. 訂單數量 (Orders)
const MockOrderPage = () => (
  <div className="bg-white min-h-full font-sans text-black">
    <div className="p-6 border-b border-[#E2E2E2]">
      <h2 className="text-3xl font-bold text-black mb-2">訂單數量</h2>
      <p className="text-sm text-[#545454]">
        即時查看您的訂單。如需詳細瞭解您的費用，請前往 <span className="text-[#276EF1] underline cursor-pointer font-medium">按訂單付款</span>。
      </p>
    </div>

    <div className="flex border-b border-[#E2E2E2] px-6 bg-[#FAFAFA]">
      <button className="px-6 py-4 text-sm font-bold text-[#545454] hover:bg-[#EEEEEE] transition-colors border-b-4 border-transparent">處理中</button>
      <button className="px-6 py-4 text-sm font-bold text-[#545454] hover:bg-[#EEEEEE] transition-colors border-b-4 border-transparent">已安排</button>
      <button className="px-6 py-4 text-sm font-bold text-black border-b-4 border-black bg-white">歷史記錄</button>
    </div>

    <div className="p-6">
      <div className="bg-[#FFF5EB] border border-[#FFC043] rounded-lg p-4 mb-8 flex items-center justify-between shadow-sm">
        <div className="flex items-center gap-4">
          <AlertTriangle className="text-[#FFC043] fill-[#FFF5EB]" size={24}/>
          <div>
            <div className="font-bold text-black text-base">已回報 4 個訂單問題</div>
            <div className="text-sm text-[#545454]">您的顧客已提交訂單相關問題。</div>
          </div>
        </div>
        <button className="bg-white border border-[#E2E2E2] text-black text-sm font-bold px-4 py-2 rounded-full hover:bg-[#F6F6F6] shadow-sm transition-colors">
          檢視訂單
        </button>
      </div>

      <div className="flex flex-wrap gap-3 mb-6">
        <div className="relative flex-1 min-w-[240px]">
          <Search className="absolute left-4 top-2.5 text-[#545454]" size={18}/>
          <input 
            type="text" 
            placeholder="搜尋顧客姓名或訂單 ID" 
            className="w-full bg-[#EEEEEE] pl-12 pr-4 py-2.5 rounded-full text-sm outline-none focus:ring-2 focus:ring-black text-black placeholder-[#AFAFAF]"
          />
        </div>
        <button className="bg-[#EEEEEE] text-black text-sm font-bold px-4 py-2.5 rounded-full flex items-center gap-2 hover:bg-[#E2E2E2] transition-colors">
          過去 7 天 <ChevronDown size={16}/>
        </button>
        <button className="bg-[#EEEEEE] text-black text-sm font-bold px-4 py-2.5 rounded-full flex items-center gap-2 hover:bg-[#E2E2E2] transition-colors">
          訂單問題 <ChevronDown size={16}/>
        </button>
      </div>

      <div className="divide-y divide-[#E2E2E2]">
        {[
          { id: '8A1B2', store: '美味餐廳 桃園大湳店', time: '11:56 PM', price: '$1,089.00', rider: '外送夥伴 A' },
          { id: '9C3D4', store: '美味餐廳 高雄八卦寮店', time: '11:52 PM', price: '$226.00', rider: '外送夥伴 B' },
          { id: '7E5F6', store: '美味餐廳 泰式生醃專賣', time: '11:50 PM', price: '$419.00', rider: '外送夥伴 C' },
          { id: '6G7H8', store: '美味餐廳 高雄八卦寮店', time: '11:43 PM', price: '$180.00', rider: '外送夥伴 D' }
        ].map((order, idx) => (
          <div key={idx} className="py-6 hover:bg-[#F6F6F6] transition-colors cursor-pointer group px-4 -mx-4 rounded-lg">
            <div className="flex justify-between items-start">
              <div className="space-y-1.5">
                <div className="font-bold text-lg text-black group-hover:text-[#276EF1] transition-colors">{order.id}</div>
                <div className="text-sm text-[#545454] font-medium">{order.store}</div>
                <div className="text-xs text-[#AFAFAF] flex items-center gap-1"><Calendar size={12}/> 11/30/2025 • {order.time}</div>
                <div className="text-sm font-bold text-black flex items-center gap-2 mt-2">
                  顧客 {String.fromCharCode(65+idx)} <span className="bg-[#FFC043] text-black text-[10px] px-1.5 rounded-sm font-bold">1</span>
                </div>
                <div className="text-xs text-[#545454] mt-1">外送 Uber Eats • 合作外送夥伴: {order.rider}</div>
              </div>
              <div className="font-mono font-bold text-lg text-black">{order.price}</div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </div>
);

// 4. 成效 - Sales
const MockSalesDashboard = () => (
  <div className="bg-[#F6F6F6] min-h-full p-6 font-sans text-black">
    <div className="max-w-7xl mx-auto space-y-8">
      <div className="flex justify-between items-center">
        <h2 className="text-3xl font-bold text-black">銷售額</h2>
        <div className="flex gap-3">
          <button className="bg-white border border-[#E2E2E2] px-4 py-2 rounded-full text-sm font-bold shadow-sm hover:bg-[#F6F6F6] text-black transition-colors">所有餐廳門市 (34)</button>
          <button className="bg-white border border-[#E2E2E2] px-4 py-2 rounded-full text-sm font-bold shadow-sm hover:bg-[#F6F6F6] text-black transition-colors">上週</button>
        </div>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        {[
          { title: '銷售額', val: '$170,892', change: '17%', positive: false },
          { title: '訂單數', val: '501', change: '10%', positive: false },
          { title: '平均訂單金額', val: '$341.1', change: '8%', positive: false }
        ].map((item, i) => (
          <div key={i} className={`bg-white p-6 rounded-xl border border-[#E2E2E2] shadow-sm relative overflow-hidden ${i===0 ? 'border-l-4 border-l-black' : ''}`}>
             <div className="text-xs font-bold text-[#545454] uppercase mb-2 tracking-wider">{item.title}</div>
             <div className="text-4xl font-bold text-black mb-3">{item.val}</div>
             <div className={`flex items-center text-xs font-bold w-fit px-2 py-1 rounded ${item.positive ? 'bg-[#E6F7ED] text-[#06C167]' : 'bg-[#FFF0F0] text-[#E11900]'}`}>
               {item.positive ? <TrendingUp size={14} className="mr-1"/> : <TrendingDown size={14} className="mr-1"/>} 
               {item.change}
             </div>
          </div>
        ))}
      </div>
      
      <div className="bg-white p-6 rounded-xl border border-[#E2E2E2] shadow-sm h-64 flex items-center justify-center text-[#AFAFAF]">
         <div className="w-full h-full relative">
            <div className="absolute left-0 bottom-0 top-0 w-8 flex flex-col justify-between text-xs text-[#94A3B8]">
              <span>$50k</span><span>$25k</span><span>$0</span>
            </div>
            <div className="absolute left-10 right-0 bottom-0 top-0 border-l border-b border-[#EEEEEE]">
               <svg className="w-full h-full" preserveAspectRatio="none">
                 <polyline fill="none" stroke="#276EF1" strokeWidth="3" points="0,200 100,150 200,180 300,120 400,100 500,140 600,80" />
               </svg>
            </div>
         </div>
      </div>

       <div className="bg-white p-6 rounded-xl border border-[#E2E2E2] shadow-sm">
         <h3 className="text-lg font-bold mb-8 text-black flex items-center gap-2">使用者轉換漏斗圖 <Info size={16} className="text-[#AFAFAF]"/></h3>
         <div className="flex items-end justify-around h-48 px-8 border-b border-[#F6F6F6]">
            {[
              { label: '曝光次數', val: '22K', h: '100%', color: 'bg-[#276EF1]' },
              { label: '點擊次數', val: '2.1K', h: '40%', color: 'bg-[#6CA0FC]' },
              { label: '訂單', val: '339', h: '15%', color: 'bg-[#A8C7FA]' }
            ].map((step, i) => (
              <div key={i} className="flex flex-col items-center gap-3 w-full">
                 <div className={`w-1/2 ${step.color} rounded-t-sm shadow-lg`} style={{height: step.h}}></div>
                 <div className="text-center pb-4">
                    <div className="font-bold text-black text-lg">{step.val}</div>
                    <div className="text-xs text-[#545454] font-medium mt-1">{step.label}</div>
                 </div>
              </div>
            ))}
         </div>
       </div>
    </div>
  </div>
);

// 4.1 成效 - Operations
const MockOperationsDashboard = () => (
  <div className="bg-[#F6F6F6] min-h-full p-8 font-sans text-black">
    <div className="max-w-7xl mx-auto space-y-8">
      <div className="bg-white p-8 rounded-xl border border-[#E2E2E2] shadow-sm">
        <h3 className="text-xl font-bold text-black mb-8 flex items-center gap-2">
          有問題的訂單 <AlertCircle size={20} className="text-[#AFAFAF]"/>
        </h3>
        <div className="flex gap-16 mb-8">
          <div>
            <div className="text-sm text-[#545454] mb-2 font-medium">錯誤訂單率</div>
            <div className="text-5xl font-extrabold text-black">0% <span className="text-[#06C167] text-sm font-bold ml-2 bg-[#E6F7ED] px-2 py-1 rounded">↓ 100%</span></div>
          </div>
          <div>
            <div className="text-sm text-[#545454] mb-2 font-medium">遺失費用</div>
            <div className="text-5xl font-extrabold text-black">-- <span className="text-[#06C167] text-sm font-bold ml-2">↓ 100%</span></div>
          </div>
        </div>
        <div className="h-48 w-full bg-[#FAFAFA] rounded-lg border border-dashed border-[#E2E2E2] flex items-center justify-center text-[#AFAFAF]">
           <svg className="w-full h-full p-4" preserveAspectRatio="none">
             <path d="M0,150 Q150,150 300,150 T600,150" stroke="#E11900" strokeWidth="2" fill="none" strokeDasharray="5,5" />
           </svg>
        </div>
      </div>
      
      <div className="bg-white p-8 rounded-xl border border-[#E2E2E2] shadow-sm">
        <h3 className="text-xl font-bold text-black mb-6">合作外送夥伴等待時間</h3>
        <div className="space-y-6">
           <div className="flex justify-between border-b border-[#F6F6F6] pb-4">
              <span className="text-[#545454] font-medium flex items-center gap-2">可避免的等候時間 <Info size={14}/></span>
              <span className="font-bold text-lg text-black">20 秒</span>
           </div>
           <div className="flex justify-between border-b border-[#F6F6F6] pb-4">
              <span className="text-[#545454] font-medium flex items-center gap-2">總等候時間 <Info size={14}/></span>
              <span className="font-bold text-lg text-black">2 分 26 秒</span>
           </div>
        </div>
        <button className="w-full mt-6 bg-[#F6F6F6] text-black font-bold py-3 rounded-lg hover:bg-[#EEEEEE] transition-colors">查看更多內容</button>
      </div>
    </div>
  </div>
);

// 4.2 成效 - Customer Insights
const MockCustomerInsights = () => (
  <div className="bg-[#F6F6F6] min-h-full p-8 font-sans text-black">
    <div className="max-w-7xl mx-auto space-y-8">
       <div className="flex justify-between items-center">
         <h2 className="text-3xl font-bold text-black">顧客深入分析</h2>
         <div className="flex gap-3">
           <button className="bg-white border border-[#E2E2E2] px-4 py-2 rounded-full text-sm font-bold shadow-sm hover:bg-[#F6F6F6] text-black transition-colors">所有餐廳門市</button>
           <button className="bg-white border border-[#E2E2E2] px-4 py-2 rounded-full text-sm font-bold shadow-sm hover:bg-[#F6F6F6] text-black transition-colors">過去 7 天</button>
         </div>
       </div>

       <div className="bg-white p-8 rounded-xl border border-[#E2E2E2] shadow-sm flex flex-col md:flex-row gap-16 items-center">
          <div className="w-56 h-56 rounded-full border-[20px] border-[#276EF1] flex items-center justify-center relative flex-shrink-0 shadow-inner">
             <div className="text-center">
                <div className="text-4xl font-extrabold text-black">376</div>
                <div className="text-sm text-[#545454] font-bold uppercase tracking-widest">總計</div>
             </div>
             <div className="absolute inset-0 rounded-full border-[20px] border-[#06C167] border-l-transparent border-b-transparent transform rotate-45 opacity-80"></div>
          </div>
          <div className="flex-1 w-full space-y-4">
             <div className="flex justify-between items-center p-5 bg-[#F8FAFF] rounded-lg border-l-4 border-l-[#276EF1] hover:shadow-md transition-shadow">
                <span className="font-bold text-lg text-[#276EF1]">新顧客</span>
                <span className="font-extrabold text-xl text-black">204 <span className="text-[#06C167] text-sm ml-2">↑ 5%</span></span>
             </div>
             <div className="flex justify-between items-center p-5 bg-[#F0FDF4] rounded-lg border-l-4 border-l-[#06C167] hover:shadow-md transition-shadow">
                <span className="font-bold text-lg text-[#06C167]">常客</span>
                <span className="font-extrabold text-xl text-black">66</span>
             </div>
             <div className="flex justify-between items-center p-5 bg-[#FFF5EB] rounded-lg border-l-4 border-l-[#FFC043] hover:shadow-md transition-shadow">
                <span className="font-bold text-lg text-[#E11900]">流失</span>
                <span className="font-extrabold text-xl text-black">102 <span className="text-[#E11900] text-sm ml-2">↓ 2.5%</span></span>
             </div>
          </div>
       </div>
    </div>
  </div>
);

// 4.3 評論 (Reviews)
const MockReviews = () => (
  <div className="bg-[#F6F6F6] min-h-full p-8 font-sans text-black">
    <div className="max-w-7xl mx-auto space-y-6">
       <div className="bg-white p-10 rounded-xl border border-[#E2E2E2] shadow-sm text-center">
          <h3 className="text-xl font-bold mb-4 text-[#545454]">商店總評分</h3>
          <div className="text-7xl font-extrabold mb-4 text-black">4.8</div>
          <div className="flex justify-center gap-2 text-[#FFC043] mb-8">
             {[1,2,3,4,5].map(i => <Star key={i} size={40} fill="currentColor"/>)}
          </div>
          <button className="bg-black text-white px-8 py-3 rounded-full font-bold hover:bg-[#333333] transition-colors shadow-md">查看所有評論</button>
       </div>
       
       <div className="bg-white p-8 rounded-xl border border-[#E2E2E2] shadow-sm">
          <h3 className="text-xl font-bold mb-6 text-black">菜單餐點滿意度</h3>
          <div className="flex flex-col items-center justify-center py-8">
             <div className="text-center relative mb-6">
                <div className="text-6xl font-extrabold text-[#06C167] mb-2">92%</div>
                <div className="text-sm text-[#545454] font-bold">平均好評率</div>
             </div>
          </div>
          <div className="grid grid-cols-2 gap-4 text-center border-t border-[#E2E2E2] pt-6">
             <div className="flex flex-col items-center gap-1">
               <ThumbsUp className="text-[#545454]" size={24}/> 
               <span className="font-bold text-lg text-black">478</span>
               <span className="text-xs text-[#545454]">喜歡</span>
             </div>
             <div className="flex flex-col items-center gap-1 border-l border-[#E2E2E2]">
               <ThumbsDown className="text-[#545454]" size={24}/> 
               <span className="font-bold text-lg text-black">40</span>
               <span className="text-xs text-[#545454]">不喜歡</span>
             </div>
          </div>
       </div>
    </div>
  </div>
);

// 4.4 報告 (Reports)
const MockReportsPage = () => (
  <div className="bg-white min-h-full font-sans text-black p-8 flex flex-col items-center justify-center h-full">
    <div className="flex flex-col items-center text-center mt-10 max-w-md p-10 border-2 border-dashed border-[#E2E2E2] rounded-2xl bg-[#FAFAFA]">
       <div className="bg-[#F6F6F6] w-24 h-24 rounded-full mb-8 flex items-center justify-center shadow-inner border border-[#E2E2E2]">
         <FilePlus size={40} className="text-[#AFAFAF]"/>
       </div>
       <h3 className="text-xl font-bold mb-4 text-black">尚無報告</h3>
       <p className="text-[#545454] mb-8 leading-relaxed">供應報告後，您可以在此下載 CSV 檔案以進行詳細分析。</p>
       <button className="bg-[#EEEEEE] text-[#AFAFAF] px-8 py-3 rounded-full font-bold cursor-not-allowed">建立報告</button>
    </div>
  </div>
);

// 4.5 廣告活動 (Ads Campaign)
const MockAdsCampaign = () => (
  <div className="bg-[#F6F6F6] min-h-full font-sans text-black p-8">
     <div className="max-w-3xl mx-auto bg-white rounded-xl shadow-sm border border-[#E2E2E2] overflow-hidden">
        <div className="p-6 border-b border-[#E2E2E2] flex justify-between items-center bg-[#FAFAFA]">
           <h2 className="text-xl font-bold text-black">廣告活動設定</h2>
           <span className="text-xs font-bold text-[#06C167] bg-[#E6F7ED] px-3 py-1.5 rounded-full border border-[#06C167]">進行中</span>
        </div>
        <div className="p-8 space-y-8">
           <div className="bg-[#EBF5FF] p-5 rounded-lg border border-[#276EF1] flex gap-4 items-start shadow-sm">
              <Info className="text-[#276EF1] flex-shrink-0 mt-0.5" size={24}/>
              <div>
                 <p className="font-bold text-[#276EF1] text-lg">您有 $1,490 免費廣告點數</p>
              </div>
           </div>
           <div className="space-y-6">
              <div className="pb-6 border-b border-[#E2E2E2]">
                 <label className="block font-bold text-base mb-3 text-black">預算</label>
                 <div className="flex justify-between items-center p-5 border border-[#E2E2E2] rounded-lg bg-white hover:border-black transition-colors cursor-pointer group">
                    <div className="flex items-center gap-4">
                       <DollarSign size={24} className="text-[#545454] group-hover:text-black"/>
                       <span className="font-medium text-lg text-black">平均每日 $118.33</span>
                    </div>
                    <ChevronRight size={24} className="text-[#545454] group-hover:text-black"/>
                 </div>
              </div>
           </div>
           <div className="pt-4">
              <h3 className="font-bold text-xl mb-6 text-black">預估成效</h3>
              <div className="grid grid-cols-3 gap-6">
                 <div className="p-5 bg-[#F6F6F6] rounded-xl border border-[#E2E2E2]">
                    <div className="text-sm text-[#545454] mb-2 font-medium">預估銷售額</div>
                    <div className="text-2xl font-bold text-[#06C167]">$122,863</div>
                 </div>
                 <div className="p-5 bg-[#F6F6F6] rounded-xl border border-[#E2E2E2]">
                    <div className="text-sm text-[#545454] mb-2 font-medium">ROAS</div>
                    <div className="text-2xl font-bold text-[#06C167]">8x</div>
                 </div>
                 <div className="p-5 bg-[#F6F6F6] rounded-xl border border-[#E2E2E2]">
                    <div className="text-sm text-[#545454] mb-2 font-medium">費用上限</div>
                    <div className="text-2xl font-bold text-black">$14,910</div>
                 </div>
              </div>
           </div>
        </div>
     </div>
  </div>
);

// 9. 優惠 (Offers)
const MockOffers = () => (
  <div className="bg-[#F6F6F6] min-h-full font-sans text-black p-8">
    <div className="max-w-4xl mx-auto space-y-8">
       <div className="bg-[#FFF5EB] p-8 rounded-xl flex justify-between items-center relative overflow-hidden shadow-md border border-[#FFE8CC]">
          <div className="z-10 max-w-lg">
             <span className="bg-[#06C167] text-white text-xs font-bold px-3 py-1 rounded mb-3 inline-block tracking-wide shadow-sm">為您推薦</span>
             <h3 className="text-2xl font-bold mb-3 text-black leading-tight">提供優惠，重新贏得流失的顧客</h3>
             <button className="bg-black text-white text-sm font-bold px-6 py-3 rounded-full hover:bg-[#333333] transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">建立活動</button>
          </div>
       </div>
       <h3 className="text-xl font-bold mt-10 mb-6 text-black">優惠方案類型</h3>
       <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          {[
            { title: '買 1 送 1', desc: '增加高達 22% 的銷售額', icon: <ShoppingCart size={24}/>, color: 'bg-[#E6F7ED] text-[#064225]' },
            { title: '滿額折扣', desc: '增加高達 16% 的銷售額', icon: <ShoppingBag size={24}/>, color: 'bg-[#EBF5FF] text-[#1E3A8A]' },
            { title: '單品折扣', desc: '增加高達 28% 的銷售額', icon: <Tag size={24}/>, color: 'bg-[#F3E8FF] text-[#581C87]' },
            { title: '優時光', desc: '離峰時段專屬優惠', icon: <Timer size={24}/>, color: 'bg-[#FFF5EB] text-[#7B341E]' },
          ].map((offer, i) => (
             <div key={i} className="bg-white p-6 rounded-xl border border-[#E2E2E2] hover:border-black cursor-pointer transition-all flex items-center justify-between shadow-sm hover:shadow-md">
                <div>
                   <h4 className="font-bold text-xl mb-2 text-black">{offer.title}</h4>
                   <span className={`text-xs font-bold px-3 py-1.5 rounded-md inline-block ${offer.color}`}>{offer.desc}</span>
                </div>
                <div className="text-[#AFAFAF] p-4 bg-[#F6F6F6] rounded-full">{offer.icon}</div>
             </div>
          ))}
       </div>
    </div>
  </div>
);

// 10. 行銷總覽 (Marketing Hub)
const MockMarketingHub = () => (
  <div className="bg-white w-full min-h-full font-sans pb-10 text-black">
    <div className="p-8">
       <div className="flex justify-between items-center mb-8">
          <h3 className="text-2xl font-bold text-black">進行中的活動</h3>
          <button className="bg-[#EEEEEE] px-4 py-2 rounded-full text-sm font-bold text-[#545454] hover:bg-[#E2E2E2] transition-colors">狀態: 啟用中</button>
       </div>
       <div className="border border-[#E2E2E2] rounded-xl overflow-hidden shadow-sm">
         <table className="w-full text-left">
            <thead className="text-xs text-[#545454] uppercase bg-[#FAFAFA] border-b border-[#E2E2E2]">
               <tr>
                  <th className="py-4 px-6 font-bold tracking-wider">活動名稱</th>
                  <th className="py-4 px-6 font-bold tracking-wider">狀態</th>
                  <th className="py-4 px-6 font-bold tracking-wider text-right">銷售額</th>
               </tr>
            </thead>
            <tbody className="divide-y divide-[#E2E2E2]">
               <tr className="hover:bg-[#F6F6F6] transition-colors cursor-pointer">
                  <td className="py-5 px-6 font-bold text-black underline decoration-dotted underline-offset-4">12月促銷</td>
                  <td className="py-5 px-6"><span className="flex items-center gap-2 text-sm font-bold text-[#06C167]"><div className="w-2.5 h-2.5 rounded-full bg-[#06C167]"></div> 啟用中</span></td>
                  <td className="py-5 px-6 text-right font-mono font-bold text-black">$12,450</td>
               </tr>
            </tbody>
         </table>
       </div>
    </div>
  </div>
);

// 5. 價目表 (Menu)
const MockPriceList = () => (
  <div className="bg-[#F6F6F6] min-h-full font-sans text-black p-8">
     <div className="bg-white rounded-xl shadow-sm border border-[#E2E2E2] overflow-hidden min-h-[600px]">
        <div className="p-8">
           <div className="flex justify-between items-center mb-8">
              <h2 className="text-2xl font-bold text-black">全日菜單</h2>
              <button className="bg-black text-white px-6 py-3 rounded-full text-sm font-bold flex items-center gap-2 hover:bg-[#333333] transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                 <Plus size={18}/> 新增餐點
              </button>
           </div>
           <div className="space-y-8">
              <div>
                 <h3 className="text-xl font-bold mb-4 flex items-center justify-between border-b border-[#E2E2E2] pb-3 text-black">
                    人氣精選 <span className="text-sm text-[#545454] font-normal bg-[#F6F6F6] px-2 py-1 rounded ml-2">3 個品項</span>
                 </h3>
                 <div className="space-y-4">
                    {['經典雞排', '招牌紅茶', '雞腿丁'].map((item, i) => (
                       <div key={i} className="bg-white border border-[#E2E2E2] p-5 rounded-xl flex justify-between items-center hover:border-black cursor-pointer transition-all shadow-sm hover:shadow-md group">
                          <div className="flex gap-5 items-center">
                             <div className="w-16 h-16 bg-[#F6F6F6] rounded-lg flex items-center justify-center text-[#AFAFAF] border border-[#E2E2E2] group-hover:border-[#AFAFAF] transition-colors"><ImageIcon size={24}/></div>
                             <div>
                                <div className="font-bold text-lg mb-1 text-black">{item}</div>
                                <div className="text-sm text-[#545454] font-mono bg-[#F6F6F6] px-2 py-0.5 rounded w-fit">$85.00</div>
                             </div>
                          </div>
                          <ToggleRight className="text-[#06C167] hover:opacity-80 transition-opacity" size={40}/>
                       </div>
                    ))}
                 </div>
              </div>
           </div>
        </div>
     </div>
  </div>
);

// 6. 付款詳情
const MockPaymentsDetail = () => (
  <div className="bg-white min-h-full font-sans text-black">
    <div className="p-8 border-b border-[#E2E2E2]">
       <h2 className="text-3xl font-bold mb-6 text-black">按訂單付款</h2>
       <div className="flex gap-3">
          <button className="bg-white border border-[#E2E2E2] px-4 py-2 rounded-full text-sm font-bold hover:bg-[#F6F6F6] transition-colors shadow-sm text-black">通用飲料店</button>
          <button className="bg-[#F6F6F6] px-4 py-2 rounded-full text-sm font-bold hover:bg-[#EEEEEE] transition-colors text-black">本週</button>
       </div>
    </div>
    <div className="p-8 space-y-8">
       <div className="grid grid-cols-2 md:grid-cols-4 gap-6 pb-8 border-b border-[#E2E2E2]">
          <div className="p-5 bg-[#F8F8F8] rounded-xl border border-[#EEEEEE]">
             <div className="text-xs text-[#545454] font-bold mb-2 uppercase tracking-wide">已結清訂單</div>
             <div className="text-3xl font-extrabold text-black">4</div>
          </div>
          <div className="p-5 bg-[#F8F8F8] rounded-xl border border-[#EEEEEE]">
             <div className="text-xs text-[#545454] font-bold mb-2 uppercase tracking-wide">銷售額</div>
             <div className="text-3xl font-extrabold text-black">$1,493</div>
          </div>
          <div className="p-5 bg-[#FFF5F5] rounded-xl border border-[#FFE0E0]">
             <div className="text-xs text-[#E11900] font-bold mb-2 uppercase tracking-wide">服務費</div>
             <div className="text-3xl font-extrabold text-[#E11900]">-$493</div>
          </div>
          <div className="p-5 bg-[#F0FDF4] rounded-xl border border-[#DCFCE7]">
             <div className="text-xs text-[#06C167] font-bold mb-2 uppercase tracking-wide">預估入帳</div>
             <div className="text-3xl font-extrabold text-[#06C167]">$1,000</div>
          </div>
       </div>
       
       <div className="space-y-0">
          {[1,2,3,4].map((i) => (
             <div key={i} className="py-6 border-b border-[#F6F6F6] hover:bg-[#FAFAFA] flex justify-between items-center cursor-pointer px-4 -mx-4 transition-colors group rounded-lg">
                <div>
                   <div className="font-bold text-base mb-1 text-black group-hover:text-[#276EF1] transition-colors">訂單 #{1000+i}</div>
                   <div className="text-sm text-[#545454]">12/04/2025 • 顧客 {String.fromCharCode(64+i)}</div>
                </div>
                <div className="text-right">
                   <div className="font-bold font-mono text-lg mb-1 text-black">$250.00</div>
                   <div className="text-xs text-[#06C167] font-bold bg-[#E6F7ED] px-2 py-0.5 rounded w-fit ml-auto border border-[#06C167]/20">已完成</div>
                </div>
             </div>
          ))}
       </div>
    </div>
  </div>
);

const MockReceiptSettings = () => (<div className="p-8 font-sans text-black bg-white min-h-full"><h2 className="text-3xl font-bold mb-8 text-black">收據設定</h2><div className="max-w-xl space-y-6"><div className="bg-[#F6F6F6] p-5 rounded-lg text-[#545454] font-medium border border-transparent hover:border-[#E2E2E2] transition-colors"><div className="text-xs font-bold text-[#AFAFAF] mb-1 uppercase">統一編號</div>12345678</div><div className="bg-[#F6F6F6] p-5 rounded-lg text-[#545454] font-medium border border-transparent hover:border-[#E2E2E2] transition-colors"><div className="text-xs font-bold text-[#AFAFAF] mb-1 uppercase">公司名稱</div>通用示範店</div></div></div>);
const MockBankSettings = () => (<div className="p-8 font-sans text-black bg-white min-h-full"><h2 className="text-3xl font-bold mb-8 text-black">銀行帳戶</h2><div className="max-w-xl space-y-4"><div className="bg-[#F6F6F6] p-5 rounded-lg text-[#545454] font-medium border border-transparent hover:border-[#E2E2E2] transition-colors"><div className="text-xs font-bold text-[#AFAFAF] mb-1 uppercase">銀行</div>通用商業銀行</div><div className="bg-[#F6F6F6] p-5 rounded-lg text-[#545454] font-medium border border-transparent hover:border-[#E2E2E2] transition-colors"><div className="text-xs font-bold text-[#AFAFAF] mb-1 uppercase">帳號</div>**** 1234</div></div></div>);

// 8. 使用者
const MockUsersPage = () => (<div className="p-8 font-sans text-black bg-white min-h-full"><h2 className="text-3xl font-bold mb-8 text-black">使用者</h2><div className="max-w-xl bg-[#F6F6F6] border border-[#E2E2E2] rounded-xl p-8 shadow-sm bg-white"><h3 className="font-bold text-lg mb-4 text-black">接單前台帳號</h3><p className="bg-white p-4 rounded-lg font-mono text-lg mb-6 tracking-wide text-black border border-[#E2E2E2]">store-user@ubereats.com</p><button className="text-[#06C167] font-bold text-sm hover:underline hover:text-[#05A357] transition-colors">重設密碼</button></div></div>);

// 9. 設定
const MockGeneralSettings = () => (<div className="p-8 font-sans text-black bg-white min-h-full"><h2 className="text-3xl font-bold mb-8 text-black">一般設定</h2><div className="max-w-3xl space-y-6"><div className="flex justify-between items-center p-6 border border-[#E2E2E2] rounded-xl shadow-sm hover:shadow-md transition-shadow bg-white"><span className="font-bold text-lg text-black">忙碌模式</span><ToggleRight size={48} className="text-[#06C167] drop-shadow-sm cursor-pointer"/></div><div className="flex justify-between items-center p-6 border border-[#E2E2E2] rounded-xl shadow-sm hover:shadow-md transition-shadow bg-white"><span className="font-bold text-lg text-black">無接觸訂餐</span><ToggleRight size={48} className="text-[#06C167] drop-shadow-sm cursor-pointer"/></div></div></div>);
const MockHolidayHoursSettings = () => (<div className="p-8 font-sans text-black bg-white min-h-full"><h2 className="text-3xl font-bold mb-8 text-black">假日營業時間</h2><button className="bg-black text-white px-6 py-3 rounded-full font-bold text-sm mb-8 hover:bg-[#333333] transition-colors shadow-md">+ 新增日期</button><div className="text-[#545454] text-lg bg-[#F6F6F6] p-12 rounded-xl text-center border-2 border-dashed border-[#AFAFAF]">尚無特殊營業時間設定</div></div>);
const MockPrepTimeSettings = () => (<div className="p-8 font-sans text-black bg-white min-h-full"><h2 className="text-3xl font-bold mb-8 text-black">預備時間</h2><div className="p-6 border border-[#E2E2E2] rounded-xl shadow-sm hover:shadow-md transition-shadow max-w-3xl bg-white"><h3 className="font-bold text-lg mb-2 text-black">自動調整</h3><p className="text-sm text-[#545454] mb-6">系統自動計算最佳時間</p><ToggleRight size={48} className="text-[#06C167] drop-shadow-sm cursor-pointer"/></div></div>);
const MockDocumentsSettings = () => (<div className="p-8 font-sans text-black bg-white min-h-full"><h2 className="text-3xl font-bold mb-8 text-black">文件</h2><div className="space-y-4 max-w-3xl"><div className="flex items-center gap-6 p-6 border border-[#E2E2E2] rounded-xl shadow-sm hover:shadow-md transition-shadow bg-white"><FileCheck className="text-[#06C167]" size={32}/><span className="font-bold text-lg flex-1 text-black">營業登記證</span><span className="text-[#06C167] text-sm font-bold bg-[#E6F7ED] px-3 py-1 rounded-full border border-[#06C167]/20">已核准</span></div></div></div>);

// --- Main Application Component ---

const App = () => {
  const [activeCategory, setActiveCategory] = useState<CategoryId>('home');
  const [activeFeature, setActiveFeature] = useState<string | null>(null);
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
  const [isExplanationOpen, setIsExplanationOpen] = useState(true);

  // ... categories config ...
  const categories: Category[] = [
    {
      id: 'home',
      label: '首頁',
      icon: <Home size={20} />,
      features: [{ id: 'home', title: '首頁概覽 (Dashboard)', description: '店家登入後的第一個畫面，提供今日營運的即時數據快照。', usage: '• 紅色警示：若出現「無法接單」，請優先檢查營業時間或平板連線。\n• 待辦事項：系統建議的操作（如設定菜單照片）。\n• 即時業績：隨時掌握今日已完成的訂單數與營業額。', tips: '建議每天開店前先看這裡，確認沒有紅色警示，確保順利接單。', mockUI: <MockHomeDashboard /> }]
    },
    {
      id: 'stores',
      label: '餐廳門市',
      icon: <Store size={20} />,
      features: [{ id: 'stores', title: '門市狀態管理 (Stores)', description: '監控所有分店的即時連線狀態與營業情況。', usage: '• 離線商店 (紅色)：代表平板沒開機或網路斷線，這會嚴重影響排名，請立即聯絡現場。\n• 營業中 (綠色)：正常接單中，可看到預計打烊時間。\n• 數據概覽：快速比較各店今日業績。', tips: '「上線率」是演算法排名的關鍵！請務必確保營業時間內平板保持連線。', mockUI: <MockStoresPage /> }]
    },
    {
      id: 'orders',
      label: '訂單數量',
      icon: <FileText size={20} />,
      features: [{ id: 'orders', title: '訂單查詢與管理 (Orders)', description: '查詢即時與歷史訂單細節，處理顧客客訴。', usage: '• 黃色警告：有顧客回報餐點遺漏或錯誤，需點擊檢視並回覆。\n• 歷史記錄：可依日期、訂單編號搜尋舊訂單。\n• 訂單狀態：了解訂單是「已完成」還是「已取消」。', tips: '若遇到惡意客訴，請在訂單發生後 48 小時內透過此頁面回報給 Uber 客服。', mockUI: <MockOrderPage /> }]
    },
    {
      id: 'performance',
      label: '成效',
      icon: <BarChart2 size={20} />,
      subLabels: [
        { label: '銷售額', featureId: 'perf-sales' },
        { label: '營運', featureId: 'perf-ops' }
      ],
      features: [
        { id: 'perf-sales', title: '銷售數據分析 (Sales Analytics)', description: '深度分析營收趨勢、轉換率與熱銷商品。', usage: '• 銷售額趨勢：比較本週與上週的業績差異。\n• 轉換漏斗：查看多少人看到店面 -> 點進來 -> 實際下單。\n• 趨勢指標：綠色代表成長，紅色代表衰退。', mockUI: <MockSalesDashboard /> },
        { id: 'perf-ops', title: '營運品質監控 (Operations)', description: '監控錯誤率與出餐速度，這是影響排名的核心指標。', usage: '• 錯誤訂單率：目標維持 0%，過高會被系統降權。\n• 遺失費用：因訂單錯誤被扣除的金額。\n• 外送員等待時間：盡量縮短，避免外送員久候。', tips: '如果「外送員等待時間」過長，請到「設定 -> 預備時間」調高備餐時間。', mockUI: <MockOperationsDashboard /> }
      ]
    },
    {
      id: 'customers',
      label: '顧客',
      icon: <Users size={20} />,
      subLabels: [
        { label: '顧客深入分析', featureId: 'cust-insights' },
        { label: '評論', featureId: 'cust-reviews' }
      ],
      features: [
        { id: 'cust-insights', title: '顧客分群分析 (Insights)', description: '了解新客與熟客的比例，制定精準行銷。', usage: '• 新顧客：首次下單的比例。若過低，可開「新客優惠」。\n• 流失客：久未下單的熟客。可用「買一送一」喚回。\n• 總覽圓餅圖：快速掌握客群結構。', mockUI: <MockCustomerInsights /> },
        { id: 'cust-reviews', title: '評價與回饋 (Reviews)', description: '查看商店評分與顧客具體留言。', usage: '• 總評分：低於 4.5 分需警戒。\n• 滿意度：查看顧客對特定餐點的按讚/倒讚情形。\n• 回覆：可在此直接回覆顧客留言。', mockUI: <MockReviews /> }
      ]
    },
    {
      id: 'reports',
      label: '報告',
      icon: <FileBarChart size={20} />,
      features: [{ id: 'reports', title: '下載報告 (Reports)', description: '下載 CSV 格式的詳細營運與財務報表，供會計對帳使用。', usage: '【對帳必備】\n1. 建立報告：點擊右上角按鈕。\n2. 選擇類型：通常選擇「付款詳情」或「訂單紀錄」。\n3. 下載：報告生成後會出現在列表，下載 CSV 檔後可用 Excel 開啟分析。', mockUI: <MockReportsPage /> }]
    },
    {
      id: 'ads',
      label: '廣告',
      icon: <Megaphone size={20} />,
      features: [{ id: 'ads', title: '贊助廣告活動 (Ads Campaign)', description: '付費購買曝光，讓店鋪出現在首頁顯眼處。', usage: '【廣告效益預估】\n1. 商店選擇與預算：設定您想推廣的分店與每日預算上限。\n2. 即時預覽：看廣告在消費者手機上的實際樣貌（會顯示運費、優惠標籤）。\n3. 預估結果：系統會算出投入預算後，預計能換回多少營收 (ROAS)。', mockUI: <MockAdsCampaign /> }]
    },
    {
      id: 'offers',
      label: '優惠',
      icon: <Ticket size={20} />,
      features: [{ id: 'offers', title: '優惠活動設定 (Offers)', description: '建立「買一送一」、「滿額折抵」等促銷。', usage: '【行銷利器】\n1. 買一送一：效果最好，適合推廣新品或清庫存。\n2. 滿額折扣：能有效提高客單價（例如滿 $500 折 $80）。\n3. 優時光：針對離峰時段（如下午 2-5 點）提供折扣，吸引閒暇顧客。', mockUI: <MockOffers /> }]
    },
    {
      id: 'marketing',
      label: '行銷',
      icon: <Target size={20} />,
      features: [{ id: 'marketing', title: '行銷總覽 (Marketing Hub)', description: '整合管理所有的「優惠方案」與「贊助廣告」活動。', usage: '【活動中控台】\n1. 總覽列表：一次查看所有進行中的促銷與廣告。\n2. 廣告成效：這裡直接顯示「ROAS (廣告投資報酬率)」，如果數字 > 5x 代表廣告很划算。\n3. 免費點數：注意藍色標籤，別浪費了平台贈送的廣告額度！', mockUI: <MockMarketingHub /> }]
    },
    {
      id: 'menu',
      label: '價目表',
      icon: <BookOpen size={20} />,
      features: [{ id: 'menu', title: '菜單編輯與管理 (Menu)', description: '新增餐點、修改價格、調整分類與上下架。', usage: '• 供應狀態：右側開關可快速將餐點設為「已售完」。\n• 新增餐點：點擊按鈕新增品項、圖片與描述。\n• 分類排序：可調整「人氣精選」等分類順序。', mockUI: <MockPriceList /> }]
    },
    {
      id: 'payments',
      label: '付款',
      icon: <CreditCard size={20} />,
      subLabels: [
        { label: '按訂單付款', featureId: 'payment-details' },
        { label: '收據設定', featureId: 'receipt-settings' },
        { label: '銀行', featureId: 'bank-settings' }
      ],
      features: [
        { id: 'payment-details', title: '按訂單付款 (Payments by Order)', description: '查看每一筆訂單的收入、平台費扣款以及最終撥款金額。', usage: '【對帳指南】\n1. 費用摘要：快速查看已結清的訂單數與總銷售額。\n2. 訂單明細：每筆訂單都列出了顧客姓名、交易時間與最終金額，方便核對 POS 機紀錄。\n3. 搜尋功能：可直接輸入訂單 ID 快速找單。', mockUI: <MockPaymentsDetail /> },
        { id: 'receipt-settings', title: '發票與收據設定', description: '設定統一編號與稅務資訊。', usage: '在此輸入統編與公司抬頭，確保發票開立正確。', mockUI: <MockReceiptSettings /> },
        { id: 'bank-settings', title: '銀行帳戶設定', description: '設定收款帳戶與撥款頻率。', usage: '確認銀行帳號、戶名與分行代碼，確保每週撥款順利。', mockUI: <MockBankSettings /> }
      ]
    },
    {
      id: 'users',
      label: '使用者',
      icon: <Users size={20} />,
      features: [{ id: 'users', title: '使用者權限管理', description: '管理可登入後台的人員與平板帳號。', usage: '• 平板帳號：查看店內接單平板的登入帳號，可重設密碼。\n• 管理員：新增或移除可登入此後台的員工 Email。', mockUI: <MockUsersPage /> }]
    },
    {
      id: 'settings',
      label: '設定',
      icon: <Settings size={20} />,
      subLabels: [
        { label: '一般', featureId: 'general-settings' },
        { label: '假日營業時間', featureId: 'holiday-hours' },
        { label: '預備時間', featureId: 'prep-time' },
        { label: '文件', featureId: 'documents' }
      ],
      features: [
        { id: 'general-settings', title: '一般設定 (General)', description: '管理無接觸訂餐、訂單指示、忙碌模式與過敏原設定。', usage: '【基本營運】\n1. 忙碌模式：如果現場忙不過來，請開啟此功能增加備餐時間。\n2. 無接觸訂餐：可下載 QR Code 供內用顧客掃描點餐。', mockUI: <MockGeneralSettings /> },
        { id: 'holiday-hours', title: '假日營業時間 (Holiday Hours)', description: '預先設定國定假日或公休日的營業時間。', usage: '【休假必備】\n提早設定國定假日（如過年、聖誕節）的營業時間或店休，避免顧客下單後無法接單，影響商店評分。', mockUI: <MockHolidayHoursSettings /> },
        { id: 'prep-time', title: '預備時間設定 (Prep Time)', description: '調整平均備餐時間，影響外送員抵達時間。', usage: '【外送員管理】\n建議開啟「自動調整」。若常發生外送員久候，可手動調高此時間。', mockUI: <MockPrepTimeSettings /> },
        { id: 'documents', title: '文件管理 (Documents)', description: '上傳營業登記證與食品衛生證書。', usage: '【合規檢查】\n定期檢查文件是否過期，以免商店被停權。', mockUI: <MockDocumentsSettings /> }
      ]
    }
  ];

  // Helper to determine what to render
  const getCurrentContent = () => {
    let feature = categories.find(c => c.id === activeCategory)?.features[0];
    
    if (activeFeature) {
      const found = categories.flatMap(c => c.features).find(f => f.id === activeFeature);
      if (found) feature = found;
    }

    if (!feature) return null;

    return (
      <div className="flex flex-col h-full bg-[#0a0a0a] overflow-hidden">
        {/* Top: Explanation Section - Collapsible */}
        <div 
          className={`w-full bg-[#121212] border-b border-[#333] transition-all duration-500 ease-in-out overflow-hidden flex-shrink-0 relative z-20 shadow-md ${isExplanationOpen ? 'max-h-[50vh] opacity-100' : 'max-h-0 opacity-0 border-none'}`}
        >
           <div className="p-6 max-w-5xl mx-auto">
             <div className="flex items-center justify-between mb-4">
               <div className="flex items-center gap-4">
                  <div className="bg-[#06C167] text-black p-3 rounded-xl shadow-lg">
                      {categories.find(c => c.features.includes(feature!))?.icon}
                  </div>
                  <h2 className="text-2xl font-extrabold text-white tracking-tight">{feature.title}</h2>
               </div>
               <button onClick={() => setIsExplanationOpen(false)} className="text-[#AFAFAF] hover:text-white p-2 bg-[#222] rounded-full hover:bg-[#333] transition-colors">
                  <ChevronUp size={20}/>
               </button>
             </div>
             
             <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div className="space-y-4">
                   <div className="bg-[#1E1E1E] p-5 rounded-2xl border border-[#333]">
                      <h3 className="font-bold text-base mb-2 flex items-center gap-2 text-white"><Info size={18} className="text-[#AFAFAF]"/> 功能介紹</h3>
                      <p className="text-[#AFAFAF] leading-relaxed text-sm">{feature.description}</p>
                   </div>
                   
                   {feature.tips && (
                     <div className="bg-[#1E293B] p-5 rounded-2xl border border-[#276EF1]/40 shadow-sm">
                        <h3 className="font-bold text-[#276EF1] text-base mb-2 flex items-center gap-2"><Zap size={18} className="fill-current"/> 專家撇步 (Pro Tip)</h3>
                        <p className="text-[#A5C0FF] text-sm leading-relaxed font-medium">{feature.tips}</p>
                     </div>
                   )}
                </div>

                <div className="bg-[#1E1E1E] p-5 rounded-2xl border border-[#333]">
                  <h3 className="font-bold text-base mb-3 flex items-center gap-2 text-white"><CheckCircle2 size={18}/> 如何使用 (How to use)</h3>
                  <div className="text-[#AFAFAF] leading-loose whitespace-pre-line pl-5 border-l-[4px] border-[#06C167] py-1 text-sm">
                    {feature.usage}
                  </div>
               </div>
             </div>
           </div>
        </div>

        {/* Toggle Button when closed */}
        {!isExplanationOpen && (
           <div className="absolute top-4 left-1/2 transform -translate-x-1/2 z-30">
              <button 
                onClick={() => setIsExplanationOpen(true)}
                className="bg-[#06C167] text-black text-xs font-bold px-5 py-2.5 rounded-full shadow-lg flex items-center gap-2 hover:bg-[#05A357] hover:text-white transition-all animate-in fade-in slide-in-from-top-4 hover:scale-105"
              >
                <Info size={14}/> 顯示功能說明
              </button>
           </div>
        )}

        {/* Bottom: Mock UI Preview Section - Dark Background for Frame */}
        <div 
          className="w-full bg-[#0a0a0a] flex-1 overflow-y-auto relative scroll-smooth"
          onScroll={(e) => {
             const target = e.target as HTMLDivElement;
             if (target.scrollTop > 60 && isExplanationOpen) {
                setIsExplanationOpen(false);
             }
          }}
        >
           <div className="min-h-full p-4 md:p-8 flex flex-col items-center">
             {/* Browser Frame Container */}
             <div className="w-full max-w-6xl bg-white rounded-2xl shadow-2xl border border-[#333] overflow-hidden flex flex-col min-h-[80vh] relative">
                 
                 {/* Mock Browser Header */}
                 <div className="bg-[#F6F6F6] border-b border-[#E2E2E2] p-3 flex items-center gap-2 flex-shrink-0">
                    <div className="flex gap-1.5">
                       <div className="w-3 h-3 rounded-full bg-[#FF5F57] border border-[#E0443E]"></div>
                       <div className="w-3 h-3 rounded-full bg-[#FFBD2E] border border-[#DFA123]"></div>
                       <div className="w-3 h-3 rounded-full bg-[#28C840] border border-[#1AAB29]"></div>
                    </div>
                    <div className="flex-1 bg-white h-8 rounded-md border border-[#E2E2E2] mx-4 flex items-center px-3 text-xs text-[#AFAFAF] font-mono shadow-sm">
                       merchants.ubereats.com/manager
                    </div>
                 </div>

                 {/* Content (Light Mode inside) */}
                 <div className="flex-1 overflow-y-auto bg-[#F6F6F6]">
                    {feature.mockUI}
                 </div>
             </div>
             <p className="text-[#545454] text-xs mt-4">捲動上方視窗以查看更多內容，說明區塊將自動收合。</p>
           </div>
        </div>
      </div>
    );
  };

  return (
    <div className="min-h-screen bg-[#0a0a0a] flex flex-col md:flex-row font-sans text-white overflow-hidden">
      
      {/* Mobile Header */}
      <div className="md:hidden bg-[#121212] border-b border-[#333] p-4 flex items-center justify-between sticky top-0 z-40 shadow-sm">
         <button onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)} className="p-2 -ml-2 rounded-full hover:bg-[#333]">
           <Menu size={24} className="text-white"/>
         </button>
         <span className="font-bold text-lg text-white">Uber Eats 店家後台教學網站</span>
         <div className="w-auto">
           {/* Mobile Join Button - Text Version */}
            <a 
               href="https://lin.ee/U0aUaIG" 
               target="_blank" 
               rel="noreferrer"
               className="text-[#06C167] text-sm font-bold hover:text-white transition-colors whitespace-nowrap"
             >
               快速加入 Uber Eats
             </a>
         </div>
      </div>

      {/* Sidebar Navigation */}
      <nav 
        className={`
          fixed inset-y-0 left-0 z-50 w-72 bg-[#121212] border-r border-[#333] flex flex-col h-screen overflow-hidden transform transition-transform duration-300 ease-in-out shadow-2xl md:shadow-none
          md:translate-x-0 md:static md:flex
          ${isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full'}
        `}
      >
        <div className="md:hidden absolute top-4 right-4 z-50">
          <button onClick={() => setIsMobileMenuOpen(false)} className="p-2 bg-[#333] rounded-full hover:bg-[#444]">
            <X size={20} className="text-white"/>
          </button>
        </div>

        {/* Sidebar Header */}
        <div className="p-6 border-b border-[#333] flex flex-col gap-4">
          <h1 className="font-bold text-white text-lg">Uber Eats 店家後台教學網站</h1>
        </div>
        
        <div className="flex-1 overflow-y-auto py-6 space-y-1 px-3 scrollbar-thin scrollbar-thumb-[#333] scrollbar-track-transparent">
          {categories.map((category) => {
            const isActive = activeCategory === category.id;
            return (
              <div key={category.id}>
                <button
                  onClick={() => {
                    setActiveCategory(category.id);
                    setActiveFeature(null);
                    setIsMobileMenuOpen(false);
                    setIsExplanationOpen(true); 
                  }}
                  className={`w-full flex items-center justify-between px-4 py-3 transition-all text-sm font-bold rounded-md group
                    ${isActive 
                      ? 'text-black bg-[#06C167]' 
                      : 'text-[#AFAFAF] hover:bg-[#1E1E1E] hover:text-white'
                    }`}
                >
                  <div className="flex items-center gap-4">
                    {category.icon}
                    <span className="text-base">{category.label}</span>
                  </div>
                  {category.subLabels && (
                    <ChevronDown size={16} className={`transition-transform duration-200 ${isActive ? 'rotate-180' : ''}`}/>
                  )}
                </button>
                
                {/* Sub-labels */}
                {isActive && category.subLabels && (
                  <div className="pl-4 pr-2 py-2 space-y-1">
                    {category.subLabels.map((sub, idx) => (
                      <button 
                        key={idx} 
                        onClick={(e) => {
                           e.stopPropagation();
                           setActiveFeature(sub.featureId);
                           setIsMobileMenuOpen(false);
                           setIsExplanationOpen(true);
                        }}
                        className={`w-full text-left pl-10 pr-4 py-2.5 text-sm transition-all rounded-md block font-medium
                          ${activeFeature === sub.featureId 
                             ? 'text-[#06C167] bg-[#1E1E1E]' 
                             : 'text-[#545454] hover:text-white hover:bg-[#1E1E1E]'}`}
                      >
                        {sub.label}
                      </button>
                    ))}
                  </div>
                )}
              </div>
            );
          })}
        </div>
        
        {/* Sidebar Footer */}
        <div className="p-6 border-t border-[#333] flex flex-col gap-3 text-sm font-bold bg-[#121212]">
           <a href="https://lin.ee/U0aUaIG" target="_blank" rel="noreferrer" className="flex items-center gap-3 p-3 rounded-lg hover:bg-[#1E1E1E] transition-colors group text-[#AFAFAF] hover:text-[#06C167]">
             <div className="bg-[#1E1E1E] p-2 rounded-full text-[#06C167] group-hover:bg-[#06C167] group-hover:text-black transition-colors"><UserPlus size={18}/></div>
             快速加入 Uber Eats
           </a>
        </div>
      </nav>

      {/* Overlay Backdrop */}
      {isMobileMenuOpen && (
        <div 
          className="fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden backdrop-blur-sm transition-opacity"
          onClick={() => setIsMobileMenuOpen(false)}
        ></div>
      )}

      {/* Main Content Area - Split Layout */}
      <main className="flex-1 h-[calc(100vh-64px)] md:h-screen overflow-hidden bg-[#0a0a0a]">
         {getCurrentContent()}
      </main>
    </div>
  );
};

export default App;